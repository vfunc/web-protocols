# 快速重传与快速恢复

### 为何会接收到一个失序数据段？

* 若报文丢失，将会产生连续的失序 ACK 段
* 若网络路径与设备导致数据段失序，将会产 生少量的失序 ACK 段
* 若报文重复，将会产生少量的失序 ACK 段

### 快速重传（RFC2581）

* 接收方：
  - 当接收到一个失序数据段时，立刻发送它所 期待的缺口 ACK 序列号
  - 当接收到填充失序缺口的数据段时，立刻发 送它所期待的下一个 ACK 序列号
* 发送方
  - 当接收到 3 个重复的失序 ACK 段（4 个相同 的失序 ACK 段）时，不再等待重传定时器的触发，立刻基于快速重传机制重发报文段

### 超时不会启动快速重传

### 快速重传下一定要进入慢启动吗？

* 收到重复 ACK，意味着网络仍在流动
* 慢启动会突然减少数据流

### 快速恢复（RFC2581）

* 启动快速重传且正常未失序 ACK 段到达前，启动快速恢复
* 将 ssthresh 设置为当前拥塞窗口 cwnd 的一半，设当前 cwnd 为 ssthresh 加上 3*MSS
* 每收到一个重复 ACK，cwnd 增加 1 个 MSS
* 当新数据 ACK 到达后，设置 cwnd 为 ssthresh

> 此文章为 3 月 Day29 学习笔记，内容来源于极客时间[《Web 协议详解与抓包实战》](http://gk.link/a/11UWp)，强烈推荐该课程！
